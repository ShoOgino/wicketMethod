    /**
     * This method always trie to get the WebApplicationContext set by the
     * ContextLoaderListener of Spring otherwise fails.
     * @param session
     * @return The spring application context
     * 
     * @see org.springframework.web.context.support.WebApplicationContextUtils
     */
    public static ApplicationContext getApplicationContext(Session session)
    {
        javax.servlet.http.HttpSession httpSession = ((WebSession) session)
                .getHttpSession();
        
        return WebApplicationContextUtils
                .getRequiredWebApplicationContext(httpSession
                        .getServletContext());
    }

