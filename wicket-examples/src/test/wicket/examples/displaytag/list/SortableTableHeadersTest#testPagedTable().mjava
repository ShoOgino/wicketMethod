	/**
	 * Test simple table behavior.
	 * 
	 * @throws Exception
	 */
	public void testPagedTable() throws Exception
	{
		MockWebApplication application = new MockWebApplication(null);
		application.getRequestCycleSettings().setRenderStrategy(Settings.REDIRECT_TO_BUFFER);
		application.setHomePage(SortableTableHeadersPage.class);
		application.setupRequestAndResponse();
		application.processRequestCycle();
		SortableTableHeadersPage page = (SortableTableHeadersPage)application.getLastRenderedPage();
		String document = application.getServletResponse().getDocument();
		assertTrue(validatePage(document, "SortableTableHeadersExpectedResult_1.html"));

		Link link = (Link)page.get("header:id:actionLink");
		assertTrue(link.isEnabled());

		link = (Link)page.get("header:name:actionLink");
		assertTrue(link.isEnabled());

		link = (Link)page.get("header:email:actionLink");
		assertNull(link);

		link = (Link)page.get("header:name:actionLink");
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToComponent(link);
		application.processRequestCycle();

		// Check that redirect was set as expected and invoke it
		MockHttpServletResponse redirectResponse = application.getServletResponse();

		Assert.assertTrue("Response should be a redirect", redirectResponse.isRedirect());
		String redirect = application.getServletResponse().getRedirectLocation();
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToRedirectString(redirect);
		application.processRequestCycle();

		document = application.getServletResponse().getDocument();

		assertTrue(validatePage(document, "SortableTableHeadersExpectedResult_2.html"));

		// reverse sorting
		link = (Link)page.get("header:name:actionLink");
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToComponent(link);
		application.processRequestCycle();

		// Check that redirect was set as expected and invoke it
		// Check that wicket:border tag gets removed
		Assert.assertTrue("Response should be a redirect", application.getServletResponse()
				.isRedirect());
		application.getMarkupSettings().setStripWicketTags(true);
		redirect = application.getServletResponse().getRedirectLocation();
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToRedirectString(redirect);
		application.processRequestCycle();

		document = application.getServletResponse().getDocument();

		assertTrue(validatePage(document, "SortableTableHeadersExpectedResult_3.html"));
	}

