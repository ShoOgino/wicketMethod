	/**
	 * Test simple table behavior.
	 * 
	 * @throws Exception
	 */
	public void testPagedTable() throws Exception
	{
		WicketTester application = new WicketTester(SortableTableHeadersPage.class);
		application.getApplication().getRequestCycleSettings().setRenderStrategy(
				RenderStrategy.REDIRECT_TO_BUFFER);
		application.setupRequestAndResponse();
		application.processRequestCycle();
		SortableTableHeadersPage page = (SortableTableHeadersPage)application.getLastRenderedPage();
		String document = application.getServletResponse().getDocument();
		assertTrue(DiffUtil.validatePage(document, this.getClass(),
				"SortableTableHeadersExpectedResult_1.html"));

		Link link = (Link)page.get("header:<auto>-id:actionLink");
		assertTrue(link.isEnabled());

		link = (Link)page.get("header:<auto>-name:actionLink");
		assertTrue(link.isEnabled());

		link = (Link)page.get("header:<auto>-email:actionLink");
		assertNull(link);

		link = (Link)page.get("header:<auto>-name:actionLink");
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToComponent(link);
		application.processRequestCycle();

		// Check that redirect was set as expected and invoke it
		MockHttpServletResponse redirectResponse = application.getServletResponse();

		assertTrue("Response should be a redirect", redirectResponse.isRedirect());
		String redirect = application.getServletResponse().getRedirectLocation();
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToRedirectString(redirect);
		application.processRequestCycle();

		document = application.getServletResponse().getDocument();
		assertTrue(DiffUtil.validatePage(document, this.getClass(),
				"SortableTableHeadersExpectedResult_2.html"));

		// reverse sorting
		link = (Link)page.get("header:<auto>-name:actionLink");
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToComponent(link);
		application.processRequestCycle();

		// Check that redirect was set as expected and invoke it
		// Check that wicket:border tag gets removed
		assertTrue("Response should be a redirect", application.getServletResponse().isRedirect());
		application.getApplication().getMarkupSettings().setStripWicketTags(true);
		redirect = application.getServletResponse().getRedirectLocation();
		application.setupRequestAndResponse();
		application.getServletRequest().setRequestToRedirectString(redirect);
		application.processRequestCycle();

		document = application.getServletResponse().getDocument();
		assertTrue(DiffUtil.validatePage(document, this.getClass(),
				"SortableTableHeadersExpectedResult_3.html"));
	}

