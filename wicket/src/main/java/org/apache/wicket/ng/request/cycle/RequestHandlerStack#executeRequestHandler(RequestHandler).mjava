	/**
	 * Executes the specified {@link RequestHandler}. When the specified {@link RequestHandler}
	 * finishes, the {@link RequestHandler} that invoked this method continues (unless the new
	 * {@link RequestHandler} called {@link #replaceAllRequestHandlers(RequestHandler)}.
	 * 
	 * @param handler
	 */
	public void executeRequestHandler(RequestHandler handler)
	{
		final boolean first = requestHandlers.isEmpty();
		requestHandlers.add(handler);

		RequestHandler replacementHandler = null;
		Response originalResponse = response;
		try
		{
			handler.respond(getRequestCycle());
		}
		catch (ReplaceHandlerException exception)
		{
			if (exception.removeAll && !first)
			{
				throw exception;
			}
			replacementHandler = exception.replacementRequestHandler;
		}
		finally
		{
			response = originalResponse;
			requestHandlers.poll();
			inactiveRequestHandlers.add(handler);
		}

		RequestHandler scheduled = scheduledAfterCurrent;
		scheduledAfterCurrent = null;

		if (replacementHandler != null)
		{
			executeRequestHandler(replacementHandler);
		}
		else if (scheduled != null)
		{
			executeRequestHandler(scheduled);
		}
	}

