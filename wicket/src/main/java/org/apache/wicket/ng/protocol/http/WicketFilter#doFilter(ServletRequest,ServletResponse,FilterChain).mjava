	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
		throws IOException, ServletException
	{
		try
		{
			HttpServletRequest httpServletRequest = (HttpServletRequest)request;
			HttpServletResponse httpServletResponse = (HttpServletResponse)response;

			String filterPath = getFilterPath(httpServletRequest);

			webApplication.set();

			if (checkForTrailingSlash(httpServletRequest, httpServletResponse, filterPath))
			{
				ServletWebRequest req = new ServletWebRequest(httpServletRequest, filterPath);
				WebResponse resp = new WebResponse(httpServletResponse);

				RequestCycle requestCycle = webApplication.createRequestCycle(req, resp);


				if (!requestCycle.processRequestAndDetach())
				{
					chain.doFilter(request, response);
				}
			}
		}
		finally
		{
			ThreadContext.detach();
		}
	}

