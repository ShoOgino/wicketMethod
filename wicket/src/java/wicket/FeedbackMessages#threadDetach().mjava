    /**
     * Clears the current message's instance from the thread local and
     * reset the original models of the components that had theirs replaced
     * with decorator models. To be used by the framework only (package local).
     */
    static void threadDetach()
    {
        final FeedbackMessages currentMessages = (FeedbackMessages)current.get();
        if (currentMessages != null)
        {
            if (log.isDebugEnabled())
            {
                log.debug("FeedbackMessages " + currentMessages + " released for thread "
                        + Thread.currentThread());
            }
            
            // Only error level components have their models (possibly) replaced
            final Set components = currentMessages.getErrorReporters();
            for (final Iterator i = components.iterator(); i.hasNext();)
            {
                Component component = (Component)i.next();
                IModel currentModel = component.getModel();
                
                // If the model was wrapped (ie the error message was added by the
                // validation mechanism of this framework
                if (currentModel instanceof ValidationErrorModelDecorator)
                {
                    ValidationErrorModelDecorator decorator =
                        ((ValidationErrorModelDecorator)currentModel);
                    IModel originalModel = decorator.getOriginalModel();
                    
                    // Replace the model with the initial one
                    component.setModel(originalModel);
                }
            }
            
            // Clear thread local
            current.set(null);
        }
        else
        {
            if (log.isDebugEnabled())
            {
                log.debug("No FeedbackMessages to release for thread " + Thread.currentThread());
            }
        }
    }

