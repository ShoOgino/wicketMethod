	/**
	 * For each StringResourceLoader registered with the application, load the
	 * properties file associated with the classes in the searchStack, the
	 * locale and the style. The searchStack is traversed in reverse order.
	 * <p>
	 * The property is identified by the 'key' or 'path'+'key'. 'path' is
	 * shortened (last element removed) to always represent the page relative
	 * path of the original component associate with it.
	 * 
	 * @param key
	 *            The key to obtain the resource for
	 * @param path
	 *            The component id path relative to the page
	 * @param searchStack
	 *            A stack of classes to get the resource for
	 * @param locale
	 *            The locale to get the resource for (optional)
	 * @param style
	 *            The style to get the resource for (optional) (see
	 *            {@link wicket.Session})
	 * @return The string resource
	 */
	private String visitResourceLoaders(final String key, final String path,
			final List searchStack, final Locale locale, final String style)
	{
		// Search each loader in turn and return the string if it is found
		final Iterator iterator = application.getResourceSettings().getStringResourceLoaders()
				.iterator();

		// The return value
		String string = null;
		
		// Iterate until a property has been found
		while (iterator.hasNext() && (string == null))
		{
			IStringResourceLoader loader = (IStringResourceLoader)iterator.next();

			// The key prefix is equal to the component path relativ to the 
			// current component on the top of the stack.
			String prefix = path;
			if ((searchStack != null) && (searchStack.size() > 0))
			{
				// Walk the component hierarchy down from page to the component
				for (int i = searchStack.size() - 1; (i >= 0) && (string == null); i--)
				{
					Class clazz = (Class)searchStack.get(i);
					
					// First check if the a property with the 'key' provided by the user
					// is available.
					string = loader.loadStringResource(clazz, key, locale, style);
					
					// If not, prepend the component relativ path to the key
					if ((string == null) && (path != null) && (prefix.length() > 0))
					{
						string = loader.loadStringResource(clazz, prefix + '.' + key, locale, style);
						
						// If still not found, adjust the component relativ path
						// for the next component on the path from the page down.  
						if (string == null)
						{
							prefix = Strings.afterFirst(prefix, '.');
						}
					}
				}
			}
			else
			{
				// A default string resource loader, e.g. the ApplicationStringResourceLoader,
				// does not necessarily require the component hierachy
				string = loader.loadStringResource(null, key, locale, style);
				if ((string == null) && (path != null) && (prefix.length() > 0))
				{
					string = loader.loadStringResource(null, prefix + '.' + key, locale, style);
				}
			}
		}

		return string;
	}

