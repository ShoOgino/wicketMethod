	/**
	 * Updates this session using changed state information that may have been
	 * replicated to this node on a cluster.
	 */
	public final void updateSession()
	{
		// Go through each page map in the session
		if(log.isDebugEnabled())
		{
			log.debug("updateSession(): Updating session.");
		}
		visitPageMaps(new IVisitor()
		{
			public void pageMap(PageMap pageMap)
			{
				if(log.isDebugEnabled())
				{
					log.debug("updateSession(): Attaching session to PageMap " + pageMap);
				}
				pageMap.setSession(Session.this);
			}
		});

		// Get PageStates from session attributes
		if(log.isDebugEnabled())
		{
			log.debug("updateSession(): Getting PageState attributes.");
		}
		final List pageStates = getPageStateAttributes();

		// Sort page states so that they can be added in reverse order of
		// creation. This ensures that any newer pages will bump out older ones.
		sortBySequenceNumber(pageStates);

		// Adds pages to session
		addPages(pageStates);
		if(log.isDebugEnabled())
		{
			log.debug("updateSession(): Done updating session.");
		}
	}

