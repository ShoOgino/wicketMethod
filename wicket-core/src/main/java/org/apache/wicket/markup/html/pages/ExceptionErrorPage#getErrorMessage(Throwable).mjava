	/**
	 * Converts a Throwable to a string.
	 * 
	 * @param throwable
	 *            The throwable
	 * @return The string
	 */
	public String getErrorMessage(final Throwable throwable)
	{
		if (throwable != null)
		{
			AppendingStringBuffer sb = new AppendingStringBuffer(256);

			// first print the last cause
			List<Throwable> al = convertToList(throwable);
			int length = al.size() - 1;
			Throwable cause = al.get(length);
			sb.append("Last cause: ").append(cause.getMessage()).append('\n');
			if (throwable instanceof WicketRuntimeException)
			{
				String msg = throwable.getMessage();
				if (throwable instanceof MarkupException)
				{
					MarkupStream stream = ((MarkupException)throwable).getMarkupStream();
					if (stream != null)
					{
						String text = "\n" + stream.toString();
						if (msg.endsWith(text))
						{
							msg = msg.substring(0, msg.length() - text.length());
						}
					}
				}

				sb.append("WicketMessage: ");
				sb.append(msg);
				sb.append("\n\n");
			}
			return sb.toString();
		}
		else
		{
			return "[Unknown]";
		}
	}

