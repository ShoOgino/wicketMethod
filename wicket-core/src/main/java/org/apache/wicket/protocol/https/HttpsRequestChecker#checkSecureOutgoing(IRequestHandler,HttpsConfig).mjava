	/**
	 * @param requestHandler
	 *            the original request handler
	 * @param httpsConfig
	 *            the https configuration
	 * @return either {@link SwitchProtocolRequestHandler} if the page that is going to be rendered
	 *         is annotated with @{@link RequireHttps} and the protocol of the current request is
	 *         http, or will return the original handler if these conditions are not fulfilled
	 */
	IRequestHandler checkSecureOutgoing(IRequestHandler requestHandler, HttpsConfig httpsConfig)
	{

		if (requestHandler != null && requestHandler instanceof SwitchProtocolRequestHandler)
		{
			return requestHandler;
		}

		Class<?> pageClass = getPageClass(requestHandler);
		if (pageClass != null)
		{
			final IRequestHandler redirect;

			if (hasSecureAnnotation(pageClass))
			{
				redirect = SwitchProtocolRequestHandler.requireProtocol(Protocol.HTTPS,
					requestHandler, httpsConfig);
			}
			else
			{
				redirect = SwitchProtocolRequestHandler.requireProtocol(Protocol.HTTP,
					requestHandler, httpsConfig);
			}
			if (redirect != null)
			{
				return redirect;
			}

		}
		return requestHandler;
	}

