	/**
	 * https://issues.apache.org/jira/browse/WICKET-4812
	 * https://issues.apache.org/jira/browse/WICKET-6334
	 */
	@Test
	public void whenSerializingPage_thenItsComponentsShouldBeChecked() {
		JavaSerializer serializer = new JavaSerializer("JavaSerializerTest")
		{
			@Override
			protected ObjectOutputStream newObjectOutputStream(OutputStream out) throws IOException
			{
				IObjectChecker checker = new NotDetachedModelChecker();
				return new CheckingObjectOutputStream(out, checker);
			}
		};

		MockPageWithOneComponent page = new MockPageWithOneComponent();
		page.add(new ComponentWithAttachedModel(MockPageWithOneComponent.COMPONENT_ID));

		final byte[] serialized = serializer.serialize(page);
		assertNull("The produced byte[] must be null if there was an error", serialized);
	}

