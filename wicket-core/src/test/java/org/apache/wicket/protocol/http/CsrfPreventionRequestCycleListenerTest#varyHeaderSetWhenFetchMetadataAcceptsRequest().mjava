	/** Tests that requests rejected by fetch metadata have the Vary header set */
	@Test
	void varyHeaderSetWhenFetchMetadataAcceptsRequest()
	{
		csrfListener.addAcceptedOrigin("example.com");
		tester.addRequestHeader(WebRequest.HEADER_ORIGIN, "http://example.com/");
		tester.addRequestHeader(SEC_FETCH_DEST_HEADER, CROSS_SITE);
		tester.addRequestHeader(SEC_FETCH_SITE_HEADER, CROSS_SITE);

		tester.clickLink("link");

		assertOriginsWhitelisted();
		tester.assertRenderedPage(SecondPage.class);

		String vary = tester.getLastResponse().getHeader(VARY_HEADER);
		if (vary == null)
		{
			throw new AssertionError("Vary header should not be null");
		}

		if (!vary.contains(SEC_FETCH_DEST_HEADER) || !vary.contains(SEC_FETCH_MODE_HEADER)
			|| !vary.contains(SEC_FETCH_SITE_HEADER))
		{
			throw new AssertionError("Unexpected vary header: " + vary);
		}
	}

